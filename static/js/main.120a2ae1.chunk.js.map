{"version":3,"sources":["../../src/GoogleMap.tsx","../../src/GeoJsonLayer.tsx","App.tsx","index.tsx"],"names":["GoogleMapInstance","createContext","isOnClient","window","GoogleMap","props","mapEl","useRef","useState","googleMapInstance","setGoogleMapInstance","useEffect","load","url","Promise","script","document","map","google","mapBounds","boundingBox","east","west","south","north","latLng","lat","e","lng","style","ref","value","getKeyFromGeoJson","feature","getKeyFromFeature","GeoJsonLayer","googleMap","useContext","mapData","setMapData","event","mapFeatures","idsToRemove","existingIds","newIds","newFeatures","id","featuresToAdd","getFeaturesToUpdate","key","type","features","JSON","getGeoJson","f","geometry","coordinates","properties","name","getMapFeatureStyleFunc","title","getProperty","App","React","setFeatures","setBoundingBox","setGoogleMap","interval","setInterval","prevFeatures","Math","random","floor","length","slice","clearInterval","stringify","toString","googleMapOptions","center","zoom","mapTypeId","streetViewControl","border","height","onClick","alert","onBoundsChanged","gooleMapLoaderUrl","googleMapRef","onFeatureClick","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.120a2ae1.chunk.js","sourcesContent":["import { useEffect, useRef, useState, createContext, useContext } from 'react'\nimport * as React from 'react'\nimport CSS from 'csstype'\nimport { BoundingBox, LatLng } from './Models'\n\nexport const GoogleMapInstance = createContext(null)\nconst isOnClient = typeof window !== 'undefined'\n\nexport function useGoogleMap() {\n  return useContext(GoogleMapInstance)\n}\n\nexport interface GoogleMapProps {\n  style: CSS.Properties\n  googleMapOptions: any\n  gooleMapLoaderUrl: string\n  onBoundsChanged?: (boundingBox: BoundingBox) => void\n  onClick?: (latLng: LatLng, event: any) => void\n  googleMapRef?: (map: any) => void;\n  children: any\n}\n\nfunction loadScript(url: string) {\n  if (isOnClient && typeof (window as any).google !== 'undefined') {\n    return Promise.resolve()\n  }\n\n  return new Promise((resolve) => {\n    const script = document.createElement('script')\n    script.type = 'text/javascript'\n    script.src = url\n    script.onload = resolve\n    document.head.appendChild(script)\n  })\n}\n\nexport const GoogleMap = (props: GoogleMapProps) => {\n  const mapEl = useRef(null)\n  var [googleMapInstance, setGoogleMapInstance] = useState<any>(null)\n\n  useEffect(() => {\n    if (!isOnClient) return\n    async function load() {\n      await loadScript(props.gooleMapLoaderUrl)\n\n      const google = (window as any).google\n\n      const map = new google.maps.Map(mapEl.current, props.googleMapOptions)\n      setGoogleMapInstance(map);\n      if(props.googleMapRef) {\n        props.googleMapRef(map);\n      }\n\n\n      map.addListener('bounds_changed', () => {\n        const mapBounds = map.getBounds()\n        const boundingBox = {\n          east: mapBounds.getNorthEast().lng(),\n          west: mapBounds.getSouthWest().lng(),\n          south: mapBounds.getSouthWest().lat(),\n          north: mapBounds.getNorthEast().lat()\n        }\n\n        props.onBoundsChanged && props.onBoundsChanged(boundingBox)\n      })\n      map.addListener('click', (e: any) => {\n        const latLng: LatLng = { lat: e.latLng.lat(), lng: e.latLng.lng() }\n        props.onClick && props.onClick(latLng, e)\n      })\n    }\n    load()\n  }, [])\n\n  return (\n    <div>\n      <div style={props.style} ref={mapEl}></div>\n      <GoogleMapInstance.Provider value={googleMapInstance}>\n        {isOnClient && props.children}\n      </GoogleMapInstance.Provider>\n    </div>\n  )\n}\n","import { useGoogleMap } from \"./GoogleMap\";\nimport { useEffect, useState } from \"react\";\n\ninterface GeoJsonLayerProps {\n  getMapFeatureStyleFunc: any;\n  features: any[];\n  onFeatureClick: (feature: any) => void;\n}\n\nfunction getKeyFromGeoJson(feature: any) {\n  return feature.properties.key;\n}\n\nfunction getKeyFromFeature(feature: any) {\n  return feature.getProperty(\"key\");\n}\n\nfunction getFeaturesToUpdate(mapFeatures: any[], newFeatures: any[]) {\n  const idsToRemove: any[] = [];\n  const existingIds: any[] = [];\n  const newIds: string[] = newFeatures.map((f: any) => getKeyFromGeoJson(f));\n\n  mapFeatures.forEach((feature: any) => {\n    const id = getKeyFromFeature(feature);\n    if (newIds.includes(id)) {\n      existingIds.push(id);\n    } else {\n      idsToRemove.push(id);\n    }\n  });\n\n  const featuresToAdd = newFeatures.filter(\n    (x: any) => !existingIds.includes(getKeyFromGeoJson(x))\n  );\n\n  return { featuresToAdd, idsToRemove };\n}\n\nexport function GeoJsonLayer(props: GeoJsonLayerProps) {\n  var googleMap = useGoogleMap();\n\n  let [mapData, setMapData] = useState<any>(null);\n\n  if ((window as any).google && mapData == null) {\n    mapData = new (window as any).google.maps.Data();\n\n    mapData.addListener(\"click\", function (event: any) {\n      if (props.onFeatureClick) {\n        props.onFeatureClick(event.feature);\n      }\n    });\n\n    setMapData(mapData);\n    mapData.setMap(googleMap);\n    mapData.setStyle(props.getMapFeatureStyleFunc);\n  }\n\n  useEffect(() => {\n    if (!(window as any).google) return;\n\n    const mapFeatures: any[] = [];\n    mapData.forEach((feature: any) => {\n      mapFeatures.push(feature);\n    });\n\n    const { featuresToAdd, idsToRemove } = getFeaturesToUpdate(\n      mapFeatures,\n      props.features\n    );\n\n    mapData.forEach((feature: any) => {\n      const key = getKeyFromFeature(feature);\n      if (idsToRemove.includes(key)) {\n        mapData.remove(feature);\n      }\n    });\n\n    mapData.addGeoJson({\n      type: \"FeatureCollection\",\n      features: featuresToAdd,\n    });\n\n  }, [JSON.stringify(props.features)]);\n\n  return null;\n}\n","import React from 'react'\n\nimport { GoogleMap, GeoJsonLayer } from 'another-google-map-react'\n\nimport 'another-google-map-react/dist/index.css'\n\nconst GOOGLE_MAP_LOADER_URL = `https://maps.googleapis.com/maps/api/js?v=beta&libraries=places`\n\nfunction getGeoJson(features: any[]) {\n  return features.map((f) => {\n    return {\n      type: 'Feature',\n      geometry: {\n        type: 'Point',\n        coordinates: [f.lng, f.lat]\n      },\n      properties: {\n        name: 'test',\n        id: f.id,\n        key: f.id\n      }\n    }\n  })\n}\n\nfunction getMapFeatureStyleFunc(feature: any) {\n  return {\n    title: feature.getProperty('id')\n  }\n}\n\nconst App = () => {\n  const [features, setFeatures] = React.useState<any[]>([])\n  const [boundingBox, setBoundingBox] = React.useState<any>(null);\n  const [googleMap, setGoogleMap] = React.useState<any>(null)\n\n  const add = () => {\n    setFeatures((prevFeatures) => [\n      ...prevFeatures,\n      {\n        lat: -34 + Math.random() - 0.5,\n        lng: 151 + Math.random() - 0.5,\n        id: Math.floor(Math.random() * 100000000)\n      }\n    ])\n\n    setFeatures((prevFeatures) =>\n      prevFeatures.length > 100 ? prevFeatures.slice(1) : prevFeatures\n    )\n  }\n\n  React.useEffect(() => {\n    const interval = setInterval(() => {\n      add()\n    }, 500)\n    return () => clearInterval(interval)\n  }, [])\n\n  return (\n    <div>\n      <div>{JSON.stringify(boundingBox)} Google Map ref: {(googleMap !== null).toString()}</div>\n      <GoogleMap\n        googleMapOptions={{\n          center: { lat: -34, lng: 151 },\n          zoom: 10,\n          mapTypeId: 'roadmap',\n          streetViewControl: false,\n        }}\n        style={{ border: 'solid 1px Black', height: 'calc(100vh - 200px)' }}\n        onClick={(latLng) => alert(JSON.stringify(latLng))}\n        onBoundsChanged={(boundingBox) => setBoundingBox(boundingBox)}\n        gooleMapLoaderUrl={GOOGLE_MAP_LOADER_URL}\n        googleMapRef={(map) => setGoogleMap(map)}\n      >\n        <GeoJsonLayer\n          features={getGeoJson(features)}\n          onFeatureClick={(feature) => {\n            alert(`Feature ID=${feature.getProperty('id')} clicked`)\n          }}\n          getMapFeatureStyleFunc={getMapFeatureStyleFunc}\n        ></GeoJsonLayer>\n      </GoogleMap>\n    </div>\n  )\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}