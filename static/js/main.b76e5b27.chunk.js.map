{"version":3,"sources":["../../src/GoogleMap.tsx","../../src/GeoJsonLayer.tsx","App.tsx","index.tsx"],"names":["GoogleMapInstance","createContext","isOnClient","window","GoogleMap","props","mapEl","useRef","useState","googleMapInstance","setGoogleMapInstance","useEffect","load","url","Promise","script","document","map","google","center","lat","lng","zoom","mapTypeId","streetViewControl","mapId","style","top","height","border","ref","value","getKeyFromGeoJson","feature","getKeyFromFeature","GeoJsonLayer","googleMap","useContext","mapData","setMapData","event","mapFeatures","idsToRemove","existingIds","newIds","newFeatures","id","featuresToAdd","getFeaturesToUpdate","key","type","features","JSON","getGeoJson","f","geometry","coordinates","properties","name","getMapFeatureStyleFunc","title","App","React","setFeatures","interval","setInterval","console","log","prevFeatures","Math","random","floor","length","slice","clearInterval","gooleMapLoaderUrl","mapPosition","onFeatureClick","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.b76e5b27.chunk.js","sourcesContent":["import { useEffect, useRef, useState, createContext, useContext } from 'react'\nimport * as React from 'react'\n\nexport interface LatLng {\n  lat: number\n  lng: number\n}\n\nexport const GoogleMapInstance = createContext(null)\nconst isOnClient = typeof window !== 'undefined'\n\nexport function useGoogleMap() {\n  return useContext(GoogleMapInstance)\n}\n\nexport interface GoogleMapProps {\n  mapPosition: LatLng\n  zoom: number\n  gooleMapLoaderUrl: string\n  children: any\n}\n\nfunction loadScript(url: string) {\n  if (isOnClient && typeof (window as any).google !== 'undefined') {\n    return Promise.resolve()\n  }\n\n  return new Promise((resolve) => {\n    const script = document.createElement('script')\n    script.type = 'text/javascript'\n    script.src = url\n    script.onload = resolve\n    document.head.appendChild(script)\n  })\n}\n\nexport const GoogleMap = (props: GoogleMapProps) => {\n  const mapEl = useRef(null)\n  var [googleMapInstance, setGoogleMapInstance] = useState(null)\n\n  useEffect(() => {\n    if (!isOnClient) return\n    async function load() {\n      await loadScript(props.gooleMapLoaderUrl)\n\n      const google = (window as any).google\n\n      const map = new google.maps.Map(mapEl.current, {\n        center: { lat: props.mapPosition.lat, lng: props.mapPosition.lng },\n        zoom: props.zoom,\n        mapTypeId: 'roadmap',\n        streetViewControl: false,\n        mapId: '953062f907135420'\n      })\n      setGoogleMapInstance(map)\n    }\n    load()\n  }, [])\n\n  return <div>\n    <div\n      style={{ top: '0', height: '100vh', border: 'solid 1px Black' }}\n      ref={mapEl}\n    ></div>\n    <GoogleMapInstance.Provider value={googleMapInstance}>\n      {isOnClient && props.children}\n    </GoogleMapInstance.Provider>\n  </div>\n}\n","import { useGoogleMap } from \"./GoogleMap\";\nimport { useEffect, useState } from \"react\";\n\ninterface GeoJsonLayerProps {\n  getMapFeatureStyleFunc: any;\n  features: any[];\n  onFeatureClick: (feature: any) => void;\n}\n\nfunction getKeyFromGeoJson(feature: any) {\n  return feature.properties.key;\n}\n\nfunction getKeyFromFeature(feature: any) {\n  return feature.getProperty(\"key\");\n}\n\nfunction getFeaturesToUpdate(mapFeatures: any[], newFeatures: any[]) {\n  const idsToRemove: any[] = [];\n  const existingIds: any[] = [];\n  const newIds: string[] = newFeatures.map((f: any) => getKeyFromGeoJson(f));\n\n  mapFeatures.forEach((feature: any) => {\n    const id = getKeyFromFeature(feature);\n    if (newIds.includes(id)) {\n      existingIds.push(id);\n    } else {\n      idsToRemove.push(id);\n    }\n  });\n\n  const featuresToAdd = newFeatures.filter(\n    (x: any) => !existingIds.includes(getKeyFromGeoJson(x))\n  );\n\n  return { featuresToAdd, idsToRemove };\n}\n\nexport function GeoJsonLayer(props: GeoJsonLayerProps) {\n  var googleMap = useGoogleMap();\n\n  let [mapData, setMapData] = useState<any>(null);\n\n  if ((window as any).google && mapData == null) {\n    mapData = new (window as any).google.maps.Data();\n\n    mapData.addListener(\"click\", function (event: any) {\n      if (props.onFeatureClick) {\n        props.onFeatureClick(event.feature);\n      }\n    });\n\n    setMapData(mapData);\n    mapData.setMap(googleMap);\n    mapData.setStyle(props.getMapFeatureStyleFunc);\n  }\n\n  useEffect(() => {\n    if (!(window as any).google) return;\n\n    const mapFeatures: any[] = [];\n    mapData.forEach((feature: any) => {\n      mapFeatures.push(feature);\n    });\n\n    const { featuresToAdd, idsToRemove } = getFeaturesToUpdate(\n      mapFeatures,\n      props.features\n    );\n\n    mapData.forEach((feature: any) => {\n      const key = getKeyFromFeature(feature);\n      if (idsToRemove.includes(key)) {\n        mapData.remove(feature);\n      }\n    });\n\n    mapData.addGeoJson({\n      type: \"FeatureCollection\",\n      features: featuresToAdd,\n    });\n\n  }, [JSON.stringify(props.features)]);\n\n  return null;\n}\n","import React from 'react'\n\nimport { GoogleMap, GeoJsonLayer } from 'another-google-map-react'\n\nimport 'another-google-map-react/dist/index.css'\n\nconst GOOGLE_MAP_LOADER_URL = `https://maps.googleapis.com/maps/api/js?v=beta&libraries=places`\n\nfunction getGeoJson(features: any[]) {\n  return features.map((f) => {\n    return {\n      type: 'Feature',\n      geometry: {\n        type: 'Point',\n        coordinates: [f.lng, f.lat]\n      },\n      properties: {\n        name: 'test',\n        id: f.id,\n        key: f.id\n      }\n    }\n  })\n}\n\nfunction getMapFeatureStyleFunc() {\n  return {\n    title: 'AAAA'\n  }\n}\n\nconst App = () => {\n  const [features, setFeatures] = React.useState<any[]>([])\n\n  const add = () => {\n    console.log('here')\n    setFeatures((prevFeatures) => [\n      ...prevFeatures,\n      {\n        lat: -34 + Math.random() - 0.5,\n        lng: 151 + Math.random() - 0.5,\n        id: Math.floor(Math.random() * 100000000)\n      }\n    ])\n\n    setFeatures((prevFeatures) =>\n      prevFeatures.length > 100 ? prevFeatures.slice(1) : prevFeatures\n    )\n  }\n\n  React.useEffect(() => {\n    const interval = setInterval(() => {\n      add()\n    }, 50)\n    return () => clearInterval(interval)\n  }, [])\n\n  return (\n    <div>\n      <GoogleMap\n        gooleMapLoaderUrl={GOOGLE_MAP_LOADER_URL}\n        mapPosition={{ lat: -34, lng: 151 }}\n        zoom={10}\n      >\n        <GeoJsonLayer\n          features={getGeoJson(features)}\n          onFeatureClick={() => {}}\n          getMapFeatureStyleFunc={getMapFeatureStyleFunc}\n        ></GeoJsonLayer>\n      </GoogleMap>\n    </div>\n  )\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}